# Implementation Plan: Extend model capability detection with audio support

These steps describe how to update the capability classification logic so that models
that expose audio or music generation features are tagged accordingly in the `/api/models`
response.

## 1. Review existing tests and identify the gap
1. Open `tests/test_openrouter.py`.
2. Search for `test_classify_model_capabilities_collects_unique_tags` â€“ this test
   currently checks how capability tags are computed from the OpenRouter model payload.
3. Note that there is no assertion covering audio-related metadata; this is the gap
   you will address.

## 2. Update capability detection logic
1. Edit `ai_influencer/webapp/openrouter.py`.
2. Locate the function `classify_model_capabilities` (search for the docstring
   `"Infer basic capability tags for a model definition."`).
3. Extend the logic so it recognises audio modalities and pricing signals:
   - Treat any modality string/list entries that include `"audio"`, `"music"`, or
     `"multimodal_audio"` as audio capabilities.
   - Check the pricing dictionary for keys such as `"audio"`, `"audio_generation"`,
     or `"music"` and add the `"audio"` capability when a value is present.
4. Ensure the function still normalises capability labels to lower-case and removes
   duplicates before returning the sorted list.

## 3. Add unit-test coverage for the new behaviour
1. Modify `test_classify_model_capabilities_collects_unique_tags` in
   `tests/test_openrouter.py` (use the existing fixture as a template).
2. Inject audio-related modality and pricing fields into the test payload and assert
   that the returned capability list includes the new `"audio"` tag alongside the
   existing entries.
3. If helpful, rename the test to reflect the broader coverage, e.g.
   `test_classify_model_capabilities_detects_modalities_and_pricing`.

## 4. Validate the change locally
1. From the project root run `pytest` to execute the full suite and confirm all tests
   (including the updated one) pass.
2. Review the JSON payload generated by `/api/models` (FastAPI endpoint implemented in
   `ai_influencer/webapp/main.py`) if you want to manually verify the new capability
   tag appears for audio-enabled models.

Following these steps ensures the web UI can highlight models that support audio
generation, keeping the capability summary in sync with OpenRouter's metadata.
